## Terms

GetChat is an out-of-the-box chat/messenger for your web services with closed source code. GetChat is available either as a cloud-based SaaS solution or as on-premises software for local installation.

## Overview

Web-button is a compact JS library that allows you to integrate GetChat as a single button on your website. When this button is clicked, a small window with GetChat opens. This library is designed exclusively for browser usage and does not support Node.js, as it uses primitives available only in the browser environment.

## Installation

```bash
npm install @getchat-dev/web-button
```

You can also use the legacy way and include the library on the page as follows:

```javascript
(function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0]
    if (d.getElementById(id)) return
    js = d.createElement(s)
    js.id = id
    js.src = 'https://getchat-dev.github.io/web-button/browser.js'
    fjs.parentNode.insertBefore(js, fjs)
}(document, 'script', 'getchat-jssdk'))
```

## Getting started

The main purpose of this library is to add a button to the page that, when clicked, opens or closes the GetChat window. The main parameter, uri, is a specially generated link to the GetChat service, which loads the messenger in an iframe. For security reasons, this link is generated exclusively on the backend. In the code example below, it is assumed that the link generated by the backend is somehow assigned to the variable GETCHAT_URL_GENERATED_ON_BACKEND during page generation.

### Adding the Button to the Page

#### Module way
```typescript
import { GetChat } from '@getchat-dev/web-button'

const messenger: Chat = createButton({
    uri: GETCHAT_URL_GENRATED_ON_BACKEND,
    showUnread: 'chats',
    autoload: true,
    autoopen: false,
    autoopenDelay: false,
    buttonStyle: {
        position: 'fixed',
        bottom: '30px',
        right: '30px',
        display: 'inline-block',
        verticalAlign: 'middle',
        marginLeft: '22px'
    },
    chatStyle: {
        position: 'fixed',
        zIndex: '1000',
        bottom: '30px',
        right: '30px'
    }
}: CreateButtonOptions)
```

#### Script tag way

```typescript
window.getchatonloaded = async function (SDK) {

    const messenger: Chat = SDK.createButton({
        uri: GETCHAT_URL_GENRATED_ON_BACKEND,
        showUnread: 'chats',
        autoload: true,
        autoopen: false,
        autoopenDelay: false,
        buttonStyle: {
            position: 'fixed',
            bottom: '30px',
            right: '30px',
            display: 'inline-block',
            verticalAlign: 'middle',
            marginLeft: '22px'
        },
        chatStyle: {
            position: 'fixed',
            zIndex: '1000',
            bottom: '30px',
            right: '30px'
        }
    }: CreateButtonOptions)
```

If using this method, you can get an instance of the Chat class as follows:

```typescript
const messenger: Chat = document.querySelector('getchat-button').getChatInstance();
```


In the [Interfaces](#createbuttonoptions) section, you will find all the available parameters that can be passed to the ]`createButton` function.

### How to Know When the Chat is Loaded

> The Internet: An Unprecedented and Unparalleled Platform

Any loading process is asynchronous, and GetChat is no exception. The `createButton` method returns an instance of the `Chat` class, which provides the `whenReady` method. This method returns a promise that resolves when the chat is loaded and ready for use.

```typescript
const messenger: Chat = SDK.createButton({
    uri: GETCHAT_URL_GENRATED_ON_BACKEND,
});

messenger.whenReady().then(async function () {
    console.log('Chat is ready');
});
```

### Changing the Button Style

Currently, the library supports changing the following seven parameters:

- `bgcolor` – background color of the button
- `bdradius` – border radius of the button
- `bdwidth` – border width of the button
- `bdcolor` – border color of the button
- `color` – text and icon color of the button
- `badgebg` – background color of the badge on the button
- `badgecolor` – text color of the badge on the button

#### Declarative Button Style Declaration

When creating the button, you can pass style parameters in the options object.

```typescript
const messenger: Chat = SDK.createButton({
    uri: GETCHAT_URL_GENRATED_ON_BACKEND,
    bdcolor: 'white',
    color: 'black',
    bdradius: '8px',
    bdwidth: '1px',
}: CreateButtonOptions)
```

#### Imperative Button Style Change

Here's an example of how to change the button style using the standard browser API through `Element.setAttribute`:

```typescript
messenger.whenReady().then(async function () {
    // get button node
    const button = chat.getButton();
    if (button) {
        button.setAttribute('data-bgcolor', 'white');
        button.setAttribute('data-color', 'black');
        button.setAttribute('data-bdradius', '8px');
        button.setAttribute('data-bdwidth', '1px');
    }
});
```

### Handling Chat Events

To handle chat events, you can use the `addEventListener` method. For example, to handle the event of a new message, you can use the following code. It opens the chat upon receiving a new message and logs "New message received" to the console.

```typescript
const messenger: Chat = SDK.createButton({
    uri: GETCHAT_URL_GENRATED_ON_BACKEND
});

messenger.addEventListener('getchat.chat.message.new', function () {
    messenger.open();
    console.log('New message received');
});
```

## Interfaces

### CreateButtonOptions

> **Note:** Options marked with `*` are required.

| Option            | Type                                                | Description                                      | Default      |
|-------------------|-----------------------------------------------------|--------------------------------------------------|--------------|
| `uri`*            | `string`                                            | The URI for the chat service.                    | `undefined`  |
| `insertButtonTo`* | `HTMLElement \| (() => HTMLElement) \| null`        | The HTML element to insert the button into.      | `undefined`  |
| `className`       | `string`                                            | The class name to apply to the button.           | `undefined`  |
| `showUnread`      | `boolean \| 'messages' \| 'chats'`                  | Whether to show unread messages count.           | `undefined`  |
| `autoload`        | `boolean`                                           | Whether to autoload the chat.                    | `false`      |
| `autoopen`        | `boolean`                                           | Whether to open the chat widget automatically.   | `false`      |
| `autoopenDelay`   | `number`                                            | Delay in milliseconds before auto open.          | `5000`       |
| `closeOnEscape`   | `boolean`                                           | Whether to close the chat on escape press.       | `true`       |
| `bgcolor`         | `string`                                            | Background color of the button.                  | `undefined`  |
| `bdradius`        | `string`                                            | Border radius of the button.                     | `undefined`  |
| `bdwidth`         | `string`                                            | Border width of the button.                      | `undefined`  |
| `bdcolor`         | `string`                                            | Border color of the button.                      | `undefined`  |
| `badgebg`          | `string`                                            | Background color of badge on the button.         | `undefined`  |
| `badgecolor`       | `string`                                            | Color of badge on the button.                    | `undefined`  |
| `color`           | `string`                                            | Text color of the button.                        | `undefined`  |
| `buttonStyle`     | `Partial<CSSStyleDeclaration>`                      | Custom styles to apply to the button.            | `undefined`  |
| `chatClassName`   | `string`                                            | Class name to apply to the chat window.          | `undefined`  |
| `chatParent`      | `HTMLElement \| null`                               | The parent HTML element of the chat window.      | `undefined`  |
| `chatStyle`       | `Partial<CSSStyleDeclaration>`                      | Custom styles to apply to the chat window.       | `undefined`  |
| `chatNode`        | `HTMLElement \| null`                               | The HTML element representing the chat node.     | `undefined`  |
| `node`            | `HTMLElement \| null`                               | The HTML element representing the node.          | `undefined`  |

### ChatOptions Interface

| Property            | Type                            | Default | Description                                                  |
|---------------------|---------------------------------|---------|--------------------------------------------------------------|
| `id`                | `string`                        | N/A     | A unique identifier for the chat instance.                   |
| `url`               | `string`                        | N/A     | The URL of the chat service.                                 |
| `button`            | `HTMLElement \| null`           | N/A     | Optional HTML element for the chat trigger button.           |
| `autoload`          | `boolean`                       | `false` | Whether to load the chat automatically on page load.         |
| `autoopen`          | `boolean`                       | `false` | Whether to start the chat automatically after loading.       |
| `autoopenDelay`     | `number`                        | N/A     | Delay in milliseconds before automatically opening the chat. |
| `closeOnEscape`     | `boolean`                       | `true`  | Whether to close the chat on escape press.                   |
| `onBeforeEmbedChat` | `() => void`                    | N/A     | Callback before the chat is embedded on the page.            |
| `onChatLoaded`      | `() => void`                    | N/A     | Callback when the chat is fully loaded.                      |

### Chat Class

| Method              | Parameters                                         | Returns                     | Description                                                   |
|---------------------|----------------------------------------------------|-----------------------------|---------------------------------------------------------------|
| `constructor`       | `options: ChatOptions`                             | N/A                         | Initializes a new chat instance with the provided options.    |
| `whenReady`         | N/A                                                | `Promise<void>`             | Resolves when the messenger is loaded and ready for interaction.              |
| `load`              | `showLoader?: boolean`                             | `Promise<void>`             | Loads the chat interface, optionally showing a loader.        |
| `toggle`            | N/A                                                | `Promise<void>`             | Toggles the visibility of the chat interface.                 |
| `open`              | N/A                                                | `Promise<void>`             | Opens the chat interface.                                     |
| `close`             | N/A                                                | `Promise<void>`             | Closes the chat interface.                                    |
| `addEventListener`  | `event: string, listener: () => void` | N/A        | Registers an event listener for specified chat events.        |
| `getButton`         | N/A                                                | `HTMLElement \| null`       | Returns the chat trigger button element, if any.              |
| `getChatNode`       | N/A                                                | `HTMLElement \| null`       | Retrieves the chat container element.                         |
| `getChatIframeNode` | N/A                                                | `HTMLElement \| null`       | Retrieves the chat's iframe element, if using an iframe.      |
| `rpc`               | `method: string, params: any[], timeout?: number` | `Promise<any>`              | Performs a remote procedure call to the chat service.         |
